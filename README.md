# PerParson CRM System

## Local Development
PerParson works with docker to run the MariaDB instance. Please make sure you have newest version
of docker installed on your machine.

Please make sure you have run `composer install` and `npm install` to bring dependencies in.

The `docker-compose.yml` file uses local `.env` file to borrow few variables for the database setup

Run docker (detached)
```bash
docker volume create db
docker-compose up -d
```

To run local development just invoke serve command with laravel CLI.  
```bash
php artisan serve
```


## Migrations
Please execute those commands to create all needed tables to run the application.

***PerParson Tables***
```bash
php artisan migrate
```

***Passport Tables/Installation***
```bash
php artisan passport:install
```

## Testing Env
A testing env is creating using a docker testing containers (its own database and phpmyadmin instance)
All testing `env` are kept in `.env.testing`. However, a `docker-compose` uses `.env` file to pull the 
env variables in so please make sure you have added those 2 fields into your `.env` file

```
TEST_DB_DATABASE=perparson_test
TEST_DB_PASSWORD=**Yourpassword**
```

If you wish to persists the database tables and keep them for your self
Make sure you have created `testdb` volume for `docker` to use.

```
docker volume create testdb
```

#### Migration and Seeding of Testing 
A migration and database seeding can be accomplished with simple `artisan` commands
by passing `--env` flag we ensure that the correct database will be seeded and migrated.

***Running `php artisan test` should run those commands at the beginning of the tests***

```bash
php artisan migrate --env=testing
php artisan db:seed --env=testing
```

## IDE Helpers
A dev should have access to the autocomplete generated by [barryvdh/laravel-ide-helper](https://github.com/barryvdh/laravel-ide-helper).
Please make sure you have generated all the files before pushing the code as a Pull Request.

***Automatic PHPDoc generation for Laravel Models***
```bash
php artisan ide-helper:models 
```

***Automatic PHPDoc generation for Laravel Facades***
```bash
php artisan ide-helper:generate
```

***PhpStorm Meta for Container instances***
```bash
php artisan ide-helper:meta
```
